const colorBloke2=["#2479A7","#5CB731","#FFD952"],tipoGob=[{id:"E",name:"Gob. Nacional"},{id:"R",name:"Gob. Regional"},{id:"M",name:"Gob. Local"}],tipoGra=[{id:"s",name:"Sectores"},{id:"f",name:"Funciones"},{id:"c",name:"Cat. Presupuestal"}],EJECUCION_6=[],EJECUCION_SERIES=[];var dataTotal_S,dataTotal_C,ARRAY_EJECUCION_H=[],TIPOGOB="",TIPOPA="",TIPOREPO="f",PATH="/inversion/data/",PATH_IMG="/inversion/static/img/",dataTotal_F=[],dataGeneral=[],confTipoGob="R",confTipoPA="2",dataHistorica=[];function setJs(e,t){"f"==t&&(dataGeneral=dataTotal_F=e),"s"==t?dataGeneral=dataTotal_S=e:"c"==t&&(dataGeneral=dataTotal_C=e),getInfo()}function getDataOriginal(e,t){fetch(PATH+e+"/"+t).then(e=>e.json()).then(t=>setJs(t,e))}const nombreSerie=e=>{var t;return $.grep(dataGeneral.series,function(t){return t.id===e})};function numeroComas(e){return"S/ "+e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function descArray(e,t,a){return dataGeneral.series.filter(function(e){return a.includes(e.id)})}function setData(e,t){!dataTotal_C|!dataTotal_S?getDataOriginal(e.value,t):("s"==e.value?dataGeneral=dataTotal_S:"c"==e.value?dataGeneral=dataTotal_C:"f"==e.value&&(dataGeneral=dataTotal_F),getInfo())}function onload(e){fetch(PATH+"hist/"+e).then(e=>e.json()).then(e=>{dataGeneral=dataTotal_F=e,console.log(dataTotal_F),getInfo()})}function getInfo(){var e,t,a="0",i=$("#chkAct").is(":checked"),n=$("#chkPry").is(":checked");i&&n?a="1":!i&&n?a="2":i&&!n&&(a="3");var r=$("#tipoGrafico").children("option:selected").val(),o=$("#tipoGobierno").children("option:selected").val();TIPOREPO=r,TIPOGOB=o,TIPOPA=a,"f"==TIPOREPO?$("#titulo1").html("Reporte de Inversiones </br> (Funcion)"):"s"==TIPOREPO?$("#titulo1").html("Reporte de Inversiones </br> (Sector)"):"c"==TIPOREPO&&$("#titulo1").html("Reporte de Inversiones </br> (Categor\xeda Presupuestal)"),Top5Inversiones(a,o),dataBar=DataGraficoBar(a,o),CleanBar();var l=0;for($.each(dataBar,function(e,t){l++,DrawBar(t,e+1)}),e=l+1;e<=6;e++)$("#BarCont"+e).css("background-image","url('"+PATH_IMG+"frame/Frame-1-gris.png')"),$("#BarCont"+e).css("background-repeat","no-repeat");console.log(l,a,o),DrawAreaAcumulado(a,o);let s=descArray(o,a,EJECUCION_SERIES);"f"==TIPOREPO?$("#titulo3").html("Ejecucion de funciones"):"s"==TIPOREPO?$("#titulo3").html("Ejecucion de sectores"):"c"==TIPOREPO&&$("#titulo3").html("Ejecucion de categor\xedas presupuestales"),CleanArea();var c=0;for($.each(EJECUCION_6,function(e,t){c++,DrawArea(DataArea(a,o,t),e+1,s,t)}),t=c+1;t<=6;t++)$("#chartArea"+t).css("background-image","url('"+PATH_IMG+"frame/Frame-2-gris.png')"),$("#chartArea"+t).css("background-repeat","no-repeat")}function tooltipEjecucion(e,t,a){let i='<svg width="27" height="24" viewBox="0 0 27 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.779 3.47647L2.2596 18.7632C2.06333 19.0902 1.95948 19.4609 1.95838 19.8384C1.95728 20.2159 2.05897 20.5872 2.25334 20.9152C2.4477 21.2432 2.72796 21.5165 3.06623 21.708C3.40451 21.8994 3.789 22.0024 4.18147 22.0065H23.2203C23.6128 22.0024 23.9973 21.8994 24.3356 21.708C24.6738 21.5165 24.9541 21.2432 25.1485 20.9152C25.3428 20.5872 25.4445 20.2159 25.4434 19.8384C25.4423 19.4609 25.3385 19.0902 25.1422 18.7632L15.6228 3.47647C15.4224 3.15874 15.1403 2.89605 14.8037 2.71374C14.467 2.53143 14.0872 2.43565 13.7009 2.43565C13.3146 2.43565 12.9348 2.53143 12.5981 2.71374C12.2615 2.89605 11.9794 3.15874 11.779 3.47647V3.47647Z" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M13.6382 9.06903V13.4168" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M13.6382 17.7646H13.6474" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>',n='<svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 10.6314V11.5054C20.9988 13.554 20.3355 15.5474 19.1089 17.1882C17.8823 18.829 16.1581 20.0293 14.1936 20.6101C12.2291 21.191 10.1294 21.1212 8.20775 20.4113C6.2861 19.7013 4.64542 18.3892 3.53041 16.6706C2.4154 14.9521 1.8858 12.9191 2.02059 10.8749C2.15538 8.83077 2.94735 6.88495 4.27837 5.32766C5.60938 3.77037 7.40814 2.68505 9.40638 2.23358C11.4046 1.7821 13.4953 1.98866 15.3665 2.82244" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 4L11.7143 14L8 9.98815" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>',r='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M8.99951 12.0887H14.9995" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>',o=isNaN(Math.round(a/t*100))?0:Math.round(a/t*100),l,s="";return 2023==e?o<10?(l="#FF3535",s=i):o>=10&&o<20?(l="#FFC924",s=r):(l="#4AAB31",s=n):o<50?(l="#FF3535",s=i):o>=50&&o<80?(l="#FFC924",s=r):(l="#4AAB31",s=n),'<div class="tooltipEjecucion" style="margin-left:10px; float:right ;width:58px;min-height:58px;background-color:'+l+'; border-radius: 0px 3px 3px 0px;"><div style="display: block;margin: auto; margin-top:5px; min-height:29px;width:29px;">'+s+"</div>"+o+"%</div>"}function DrawAreaAcumulado(e,t){var a,i=dataGeneral.datas,n=["#70D4F6","#CC93CD","#FFDD87","#94DA88","#FF8E8E"];let r=$.grep(i,function(a){return a.t===e&&a.g==t&&a.a<=2023});top3=Top3(r).splice(0,5);let o=r.filter(function(e){return top3.includes(e.c)});dataHistorica=d=(e=>e.reduce((e,t)=>{let a=t.c;return e[a]=(e[a]||[]).concat(t),e},{}))(o);var l=[],s=0;$.each(d,function(e,t){let a=[];d=t.sort(compareValues("a")),$.each(d,function(e,t){a.push({x:parseInt(t.a),y:t.p,d:t.d})}),serie={name:nombreSerie(e)[0].name,color:n[s],data:a},l.push(serie),s++});let c="";console.log(TIPOREPO),"f"==TIPOREPO?c='<div class="titleAll" style="position:absolute;">Hist\xf3rico de funciones con mayor inversi\xf3n (2016-2023)</div>':"s"==TIPOREPO?c='<div class="titleAll" style="position:absolute;">Hist\xf3rico de sectores con mayor inversi\xf3n (2016-2023)</div>':"c"==TIPOREPO&&(c='<div class="titleCategoria" style="position:absolute;">Hist\xf3rico de categoria presupuestal con mayor inversi\xf3n (2016-2023)</div>'),Highcharts.chart("charArea",{chart:{type:"area",backgroundColor:"transparent",marginTop:70},title:{align:"left",margin:50,x:0,y:10,useHTML:!0,text:c},credits:{enabled:!1},legend:{itemStyle:{fontFamily:"Calibri"},layout:"horizontal",align:"right",verticalAlign:"top",itemWidth:150},xAxis:{width:"100%",left:75,lineWidth:0,labels:{style:{fontSize:"18px",fontFamily:"Calibri"}},categories:["2016","2017","2018","2019","2020","2021","2022","2023"]},yAxis:{left:155,lineColor:"#828282",lineWidth:1,labels:{formatter:function(){return[""+this.value].map(e=>(console.log(e),e>0&&e<1e6)?(e/1e3).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" Mil":1e6==e?(e/1e6).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" Mill\xf3n":e>1e6&&e<1e11?(e/1e6).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" Millones":void 0)},style:{fontSize:"18px",fontFamily:"Calibri"}},title:{text:""},allowDecimals:!1},tooltip:{useHTML:!0,padding:0,borderWidth:0,style:{opacity:1,background:"rgba(255, 255, 255, 1)"},formatter:function(){return'<div style="display:flex;margin-left:10px; min-height:58px;font-family: Calibri;font-style: normal;font-weight: normal;font-size:18px;"><div style="margin-top:5px; height:55px;"><div style="display:flex;"><div  style="width:153px;"> <span>Presup. total:</span></div><div><div style="min-width:130px;text-align:right;">'+numeroComas(this.y)+'</div></div></div><div style="display:flex;"><div  style="width:153px;"><span style="font-family: Calibri;font-style: normal;font-weight: normal;font-size:18px;">Presup. ejecutado:</span></div><div style="min-width:130px;text-align:right;"><tspan>'+numeroComas(this.point.options.d)+"</tspan></div></div></div>"+tooltipEjecucion(this.point.x,this.y,this.point.options.d)+"</div>"}},plotOptions:{area:{pointStart:2016,fillOpacity:.5,groupPadding:0,pointPadding:.1,borderWidth:0}},series:l})}function Top5Inversiones(e,t){$("#titleTop5").html("Top 5 de Inversi\xf3n de presupuesto de la regi\xf3n"),$("#frame4").css("background-image","url('None')");var a=[],i=[],n=dataGeneral.datas;dataGeneral.series,i=$.grep(n,function(a){return a.t===e&&a.g==t&&2023==a.a}).reduce(function(e,t){return e[t.c]||(e[t.c]={c:t.c,p:0},a.push(e[t.c])),e[t.c].p+=t.p,e},{}),(a=(a=(a=a.map(e=>({name:nombreSerie(e.c)[0].name,y:e.p}))).sort(compareValues("y","desc"))).splice(0,5)).length?Highcharts.chart("grafico1",{chart:{backgroundColor:"transparent",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},credits:{enabled:!1},title:{text:""},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},accessibility:{point:{valueSuffix:"%"}},plotOptions:{pie:{colors:["#227CAC","#FF6356","#FACA1F","#70A745","#750280"],size:200,allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,useHTML:!0,distance:5,crop:!1,overflow:"justify",pointPadding:0,borderWidth:0,allowOverlap:!0,colors:["#227CAC","#FF6356","#FACA1F","#70A745","#750280"],connectorWidth:0,style:{fontFamily:"Calibri",fontSize:"20px"},formatter:function(){return'<span style="color:'+this.point.color+';"><b>'+numeroComas(this.point.y)+"</span>"}},showInLegend:!0}},legend:{enabled:!0,itemWidth:140,itemStyle:{fontFamily:"Calibri",fontSize:"12px"}},series:[{name:"Inversiones",data:a}]}):(console.log("url('"+PATH_IMG+"frame/Frame-4-gris.png')"),$("#titleTop5").html(""),$("#grafico1").html(""),$("#frame4").css("background-image","url('"+PATH_IMG+"frame/Frame-4-gris.png')"))}function CleanArea(){for(var e=1;e<=6;e++)$("#chartArea"+e).html(""),$("#chartArea"+e).css("background-image","none")}function CleanBar(){for(var e=1;e<=6;e++)$("#footerBar"+e).html(""),$("#titleBar"+e).html(""),$("#chartBar"+e).html(""),$("#BarCont"+e).removeClass("borderBar"),$("#BarCont"+e).css("background-image","none");"c"==TIPOREPO?$("#titulo2").html("Categor\xedas presupuestales con mayor inversi\xf3n 2023"):"s"==TIPOREPO?$("#titulo2").html("Sectores con mayor inversi\xf3n 2023"):"f"==TIPOREPO&&$("#titulo2").html("Funciones con mayor inversi\xf3n 2023")}function DrawBar(e,t){let a="#titleBar"+t;$("#BarCont"+t).addClass("borderBar");var i=["#2479A7","#5CB731","#FFD700"],n=e.data.per.map((e,t)=>'<span style="color:'+i[t]+'"><b>'+e+"%</b></span>");let r="<span>"+e.name+"</span>",o=$.map(e.data.monto,function(e,t){return $("<div style='width:142px;margin-left:46px;display: flex;align-items: center;'><svg width='20' height='20'><circle cx='10' cy='10' r='10' fill='"+i[t]+"'/></svg><div  style='min-width:122px;text-align:right;'><span style='font-size:16px;align: right;'>"+numeroComas(e)+"</span></div></div>")});Highcharts.chart("chartBar"+t,{colors:i,credits:{enabled:!1},chart:{type:"column",inverted:!0,polar:!0,margin:[0,0,0,0],backgroundColor:"transparent"},title:{text:""},tooltip:{enabled:!1},pane:{size:"85%",innerSize:"20%",endAngle:270},xAxis:{tickInterval:1,labels:{align:"right",useHTML:!0,allowOverlap:!0,step:1,y:3,style:{fontSize:"18px",fontFamily:"Calibri"}},lineWidth:0,categories:n},yAxis:{crosshair:{enabled:!0,color:"#333"},lineWidth:0,tickInterval:20,reversedStacks:!1,endOnTick:!0,showLastLabel:!0,labels:{distance:3,style:{fontSize:"12px",fontFamily:"Calibri",color:"#BDBDBD"}}},plotOptions:{column:{size:80,stacking:"normal",borderWidth:0,pointPadding:0,groupPadding:.15}},series:[{colorByPoint:!0,name:"Gold medals",data:e.data.per}],legend:{enabled:!1}}),$("#footerBar"+t).html(o),$(a).html(r),textFit($(a),{minFontSize:8,maxFontSize:18})}function DataArea(e,t,a){let i=dataGeneral.datas,n=$.grep(i,function(i){return i.t===e&&i.g==t&&i.c==a&&i.a<2024}).sort(compareValues("a")),r=[],o=[],l=[];return $.each(n,function(e,t){r.push({x:parseInt(t.a),y:t.p}),o.push({x:parseInt(t.a),y:t.d})}),serieP={name:"Presupuesto Total",data:r,color:"#70D4F6"},serieD={name:"Presupuesto ejecutado",data:o,color:"#FFA4A4"},l.push(serieP),l.push(serieD),l}function selEjecucion(e,t){let a=DataArea(TIPOPA,TIPOGOB,t.value);$("#chartArea"+e).highcharts().update({series:a})}function DrawArea(e,t,a,i){let n="";$.each(a,function(e,t){i==t.id?n+='<option value="'+t.id+'" selected>'+t.name+"</option>":n+='<option value="'+t.id+'">'+t.name+"</option>"});let r='<div style="position:absolute;"><select id="comboArea'+t+'" class="filtro-select-ejecucion" onchange="selEjecucion('+t+',this);" >'+n+"</div>";ARRAY_EJECUCION_H.push(Highcharts.chart("chartArea"+t,{chart:{type:"area",backgroundColor:"transparent",marginTop:70},title:{text:r,useHTML:!0,align:"left",margin:50,x:0,y:20},credits:{enabled:!1},legend:{itemStyle:{fontFamily:"Calibri",fontSize:"16px"},layout:"horizontal",align:"right",verticalAlign:"top",y:0},xAxis:{width:"100%",lineWidth:0,labels:{style:{fontSize:"18px",fontFamily:"Calibri"}},categories:["2016","2017","2018","2019","2020","2021","2022","2023"]},yAxis:{lineColor:"#828282",lineWidth:1,labels:{formatter:function(){return[""+this.value].map(e=>(console.log(e),e>0&&e<1e6)?(e/1e3).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" Mil":1e6==e?(e/1e6).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" Mill\xf3n":e>1e6&&e<1e11?(e/1e6).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" Millones":void 0)},style:{fontSize:"18px",fontFamily:"Calibri"}},title:{text:""},allowDecimals:!1},tooltip:{crosshairs:[{width:2,color:"rgba(0,0,0,0.2)",zIndex:3}],shared:!0,useHTML:!0,padding:0,borderWidth:0},plotOptions:{area:{pointStart:2016,fillOpacity:.5}},series:e}))}const SeriesName=()=>dataGeneral.series.map(function(e){return e.valueField=e.valuefield,delete e.valuefield,e});function numberWithCommas(e){return"S/ "+e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function Top3(e){var t=[],a=[];a=e.reduce(function(e,a){return e[a.c]||(e[a.c]={c:a.c,p:0},t.push(e[a.c])),e[a.c].p+=a.p,e},{}),t=t.sort(compareValues("p","desc"));var i=[];for(var n in EJECUCION_SERIES.length=0,EJECUCION_6.length=0,t)EJECUCION_SERIES.push(t[n].c),n<6&&EJECUCION_6.push(t[n].c),i.push(t[n].c);return i}function DataSerie(e){let t=dataGeneral.series,a=[];return t.filter(function(t){return e.includes(t.id)})}function DataSerie2(e){let t=[];return e.map(function(e){return e.valueField=e.id,e})}function compareValues(e,t="asc"){return function a(i,n){if(!i.hasOwnProperty(e)||!n.hasOwnProperty(e))return 0;let r="string"==typeof i[e]?i[e].toUpperCase():i[e],o="string"==typeof n[e]?n[e].toUpperCase():n[e],l=0;return r>o?l=1:r<o&&(l=-1),"desc"===t?-1*l:l}}function DataBloke2(e,t,a){let i=dataGeneral.datas;return $.grep(i,function(i){return i.t===e&&i.g==t&&i.c==a&&i.a<2024}).sort(compareValues("a"))}function combo(e){let t=dataGeneral.series;$("#cmb"+e).dxSelectBox({width:250,items:t,value:1,valueExpr:"id",displayExpr:"name",onValueChanged:function(t){let a=DataBloke2(confTipoPA,confTipoGob,t.value);$("#as"+e).dxChart("option","dataSource",a)}})}function createChart(e,t){combo(e),$("#as"+e).dxChart({margin:{right:20},palette:"Harmony Light",dataSource:t,commonSeriesSettings:{type:"area",argumentField:"a",area:{point:{visible:!0}}},series:[{valueField:"p",name:"Presupuesto Total",color:"#FF7D7D"},{valueField:"d",name:"Presupuesto Ejecutado",color:"#50BDE3"}],margin:{bottom:20},argumentAxis:{valueMarginsEnabled:!1},legend:{visible:!1},size:{height:270},onLegendClick:function(e){var t=e.target;t.isVisible()?t.hide():t.show()}}).dxChart("instance")}function createPie(e){let t=dataGeneral.series;$("#pie").dxPieChart({size:{height:380},innerRadius:.65,type:"doughnut",resolveLabelOverlapping:"shift",palette:"Soft Pastel",dataSource:e,legend:{visible:!1,horizontalAlignment:"center",verticalAlignment:"bottom"},series:[{smallValuesGrouping:{mode:"topN",topCount:3},argumentField:"c",valueField:"p",label:{visible:!0,connector:{visible:!0,width:2},font:{size:14},format:"fixedPoint",backgroundColor:"none",customizeText:function(e){var a=$.grep(t,function(t){return t.id==e.argumentText});return(a[0]?a[0].name:"otros")+"\n<b>"+e.valueText+"</b>"}}}],centerTemplate:function(e,t){var a=e.getAllSeries()[0].getVisiblePoints().reduce(function(e,t){return e+t.originalValue},0),i=$('<svg><circle cx="100" cy="100" fill="#eee" r="'+(e.getInnerRadius()-6)+'"></circle><text text-anchor="middle" style="font-size: 18px" x="100" y="90" fill="#494949"><tspan x="100" dy="20px" style="font-size:28px;font-weight: 600">'+numberWithCommas(a)+"</tspan></text></svg>");t.appendChild(i.get(0))}})}function DataGraficoBar(e,t){var a=dataGeneral.datas,i=$.grep(a,function(a){return a.t===e&&a.g==t&&2023==a.a});i=(i=i.sort(compareValues("p","desc"))).splice(0,6);var n=$.map(i,function(e){var t=[];return t.push({id:e.c,name:nombreSerie(e.c)[0].name,data:{monto:[e.p,e.d,e.i],per:[100,Math.round(e.d/e.p*100),Math.round(e.i/e.p*100)]}}),t});return console.log(n),n}function DataBloke3(e,t,a){var i=dataGeneral.datas,n=$.grep(i,function(i){return i.t===e&&i.g==t&&i.c==a&&2023==i.a});return n=(n=n.sort(compareValues("p","desc"))).splice(0,3),$.map(n,function(e){var t=[];return t.push({name:"Presupuesto",count:100,m:e.p},{name:"Devengado",count:Math.round(e.d/e.p*100),m:e.d},{name:"Girado",count:Math.round(e.i/e.p*100),m:e.i}),t})}function DataForm(e,t,a){let i=$.grep(a,function(a){return a.t===e&&a.g==t&&a.a<2024});top3=Top3(i);let n=i.filter(function(e){return top3.includes(e.c)}),r=DataSerie(top3,dataGeneral.series);dataHistorica=d=(e=>e.reduce((e,t)=>{let a=t.a;return e[a]=(e[a]||[]).concat(t),e},{}))(n);var o,l=[];let s;$.each(d,function(e,t){s='{"year":"'+e+'",',$.each(t,function(e,t){s+='"'+t.c+'":'+t.p+","}),s=s.slice(0,-1)+"},",l.push(JSON.parse(s.slice(0,-1)))}),$("#chart").dxChart({size:{height:500},palette:"Harmony Light",dataSource:l,commonSeriesSettings:{type:"area",argumentField:"year",area:{point:{visible:!0}}},series:DataSerie2(r),margin:{bottom:20},title:"Hist\xf3rico de funciones con mayor inversi\xf3n (2016-2023)",argumentAxis:{valueMarginsEnabled:!1},legend:{verticalAlignment:"top",horizontalAlignment:"center"},yAxis:{labels:{formatter:function(){return this.value/1e6+"M"},style:{fontSize:"18px",fontFamily:"Calibri"}}},onLegendClick:function(e){var t=e.target;t.isVisible()?t.hide():t.show()},tooltip:{enabled:!0,contentTemplate:function(e,t){}}}).dxChart("instance")}